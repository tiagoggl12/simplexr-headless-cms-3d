# =============================================================================
# Simplexr Backend & Admin - Development Docker Compose
# =============================================================================
# Usa servi√ßos de infraestrutura existentes (postgres, redis, minio)
# Execute primeiro: docker compose -f docker/docker-compose.yml up -d
# Depois: docker compose -f docker/docker-compose.dev.yml up -d
# =============================================================================

services:
  backend:
    build:
      context: ..
      dockerfile: docker/backend/Dockerfile.dev
    container_name: simplexr-backend-dev
    environment:
      DATABASE_URL: postgresql://dam:dam@postgres:5432/dam?schema=public
      REDIS_URL: redis://redis:6379
      S3_ENDPOINT: http://minio:9000
      S3_ACCESS_KEY: minioadmin
      S3_SECRET_KEY: minioadmin_secret
      S3_BUCKET: assets
      S3_REGION: us-east-1
      NODE_ENV: development
      PORT: 3000
      JWT_SECRET: dev-secret-key-change-in-production
      FRONTEND_URL: http://localhost:5173
      PUBLIC_API_URL: http://localhost:3000
      STORAGE_TYPE: s3
      UPLOAD_DIR: /tmp/uploads
      MAX_FILE_SIZE: 104857600
    ports:
      - "3001:3000"
    volumes:
      - ../src:/app/src:ro
      - ../prisma:/app/prisma:ro
      - uploads_data:/tmp/uploads
    networks:
      - simplexr-headless-cms-3d_simplexr-network
    extra_hosts:
      - "host.docker.internal:host-gateway"

  admin:
    build:
      context: ..
      dockerfile: docker/admin/Dockerfile.dev
    container_name: simplexr-admin-dev
    environment:
      VITE_API_URL: http://localhost:3000
      VITE_S3_ENDPOINT: http://localhost:9000
      VITE_S3_BUCKET: assets
      VITE_S3_REGION: us-east-1
      NODE_ENV: development
    ports:
      - "5174:5173"
    volumes:
      - ../admin/src:/app/src:ro
      - ../admin:/app:ro
      - admin_node_modules:/app/node_modules
    networks:
      - simplexr-headless-cms-3d_simplexr-network

volumes:
  uploads_data:
  admin_node_modules:

networks:
  simplexr-headless-cms-3d_simplexr-network:
    external: true
