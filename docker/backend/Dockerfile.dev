# =============================================================================
# Backend Dockerfile - Development mode with hot reload
# =============================================================================

FROM node:20-alpine

# Install watchman and other dev tools
RUN apk add --no-cache bash curl watchman

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install all dependencies (including dev dependencies)
RUN npm ci

# Copy source code
COPY prisma ./prisma/
COPY src ./src/
COPY tsconfig.json ./

# Generate Prisma client
RUN npx prisma generate

# Environment configuration
ENV NODE_ENV=development
ENV HOST=0.0.0.0
ENV PORT=3000

# Expose port
EXPOSE 3000

# Install tsx globally for hot reload
RUN npm install -g tsx

# Start with tsx for hot reload
CMD ["tsx", "watch", "src/server.ts"]
